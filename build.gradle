apply plugin: 'java'

jar {
    version = '1.0'
    baseName = 'manual-tests'
}

dependencies {
    compile project(':core')
    compile project(':logging')
}

// region Shared sub-projects configuration

allprojects {
    apply plugin: 'java'
    apply plugin: 'maven'

    task checkUploadProperties << {
        if (!this.hasProperty("mavenUserPassword")) {
            throw new GroovyRuntimeException("Property mavenUserPassword should be defined for uploadArchives task")
        } else if (!this.hasProperty("mavenUsername")) {
            throw new GroovyRuntimeException("Property mavenUsername should be defined for uploadArchives task")
        } else if (!this.hasProperty("mavenRepositoryUrl")) {
            throw new GroovyRuntimeException("Property mavenRepositoryUrl should be defined for uploadArchives task")
        }
    }

    task checkIfReleaseAndUpdateVersion << {
        if (this.hasProperty("releaseVersion")) {
            version = releaseVersion
        }
    }
    tasks.uploadArchives.dependsOn(checkUploadProperties)
    tasks.uploadArchives.dependsOn(checkIfReleaseAndUpdateVersion)

    compileJava {
        sourceCompatibility = 1.6
        targetCompatibility = 1.6
        options.bootClasspath = "${System.getenv('JAVA_JRE_6')}/lib/rt.jar"
    }

    configurations {
        deployerJars
    }

    dependencies {
        deployerJars "org.apache.maven.wagon:wagon-ftp:2.8"
    }

    repositories {
        mavenCentral()
    }

    dependencies {
        testCompile group: 'junit', name: 'junit', version: '4.11'
        testCompile group: 'org.mockito', name: 'mockito-all', version: '1.8.0'
    }
}

// Azure SDK Pom as a reference: https://repo1.maven.org/maven2/com/microsoft/azure/azure-core/0.7.0/azure-core-0.7.0.pom
def updatePomWithGeneralProjectInformation(pomObject) {
    pomObject.project {
        licenses {
            license {
                name = "MIT License"
                url = "http://www.opensource.org/licenses/mit-license.php"
            }
        }

        scm {
            url = "scm:git:https://github.com/Microsoft/AppInsights-Java"
            connection = "scm:git:git://github.com/Microsoft/AppInsights-Java.git"
        }

        // This section was taken from Azure SDK core POM.
        developers {
            developer {
                id = "microsoft"
                name = "Microsoft"
            }
        }
    }
}

// endregion Shared sub-projects configuration